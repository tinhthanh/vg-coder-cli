<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Service Worker</title>
    <!-- CSS & JS Injected via Gulp -->
</head>
<body style="display: none;">
    <!-- BUBBLE INTERFACE -->
    <div id="vg-bubble" class="vg-bubble" title="VG Coder (Click to Open, Drag to Move)">
        <div class="vg-bubble-icon"><img style="width: 64px;" src="https://phanmemvet.vn/wp-content/vetgo/pawai.gif"></div>
        <!-- Quick Action Menu (Shows on hover) -->
        <div class="vg-bubble-menu">
            <button id="quick-paste-run" class="bubble-action-btn" title="Paste & Run from Clipboard">
                Paste & Run from Clipboard
            </button>
        </div>
    </div>

    <!-- MAIN DASHBOARD INTERFACE -->
    <div class="split-layout">
        <div class="left-panel">
            <div class="container">
                <div class="header">
                    <div class="header-top-row">
                        <div class="header-left-group">
                            <span class="status" id="status" style="font-size: 14px;">‚óè</span>
                            <div class="project-switcher">
                                <select id="project-selector" class="project-selector" onchange="window.switchProject(this.value)" title="Switch Project">
                                    <option value="">Loading...</option>
                                </select>
                                <span class="project-count" id="project-count">1 project</span>
                            </div>
                        </div>
                        <div class="header-actions">
                            <button class="stop-server-btn" id="stop-server-btn" onclick="window.stopServer()" title="Stop Server">üõë</button>
                            <button class="theme-toggle" id="theme-toggle" title="Toggle Dark Mode">
                                <span id="theme-icon">üåô</span>
                            </button>
                        </div>
                    </div>
                    <div class="header-bottom-row">
                        <div class="project-meta" id="project-meta">...</div>
                        <div id="project-name" style="display: none;"></div>
                    </div>
                </div>

                <!-- Saved Commands -->
                <div class="endpoint-card saved-commands-panel">
                    <div class="saved-commands-header">
                        <div class="saved-commands-title"><span class="command-icon-header">üíæ</span><span>Saved Commands</span></div>
                        <div class="saved-commands-actions">
                            <button class="btn-new-terminal" onclick="createNewTerminal()" title="New Terminal">üñ•Ô∏è</button>
                            <button class="btn-add-command" onclick="openAddCommandModal()" title="Add Command">‚ûï</button>
                        </div>
                    </div>
                    <div class="saved-commands-content" id="saved-commands-content">
                        <div id="commands-list" class="commands-list"></div>
                        <div class="empty-state" id="commands-empty-state" style="display: none;">
                            <p style="color: #888; text-align: center; padding: 15px 10px; font-size: 12px; margin: 0;">Click ‚ûï to add a command</p>
                        </div>
                    </div>
                </div>

                <div class="system-prompt-card">
                    <div class="system-prompt-header" onclick="toggleSystemPrompt()">
                        <div class="header-title-group">
                            <button class="btn-icon-head" onclick="copySystemPromptFromHeader(event)" title="Copy System Prompt">üìã</button>
                            <h2>System Prompt</h2>
                        </div>
                        <span class="toggle-icon" id="toggle-icon">‚ñº</span>
                    </div>
                    <div class="system-prompt-content" id="system-prompt-content">
                        <div class="prompt-text" id="prompt-text"></div>
                        <button class="btn btn-copy" onclick="copySystemPrompt(event)">
                            <span id="copy-icon">üìã</span>
                            <span id="copy-text">Copy System Prompt</span>
                        </button>
                    </div>
                </div>

                <div class="endpoints">
                    <div class="endpoint-card">
                        <div class="endpoint-header">
                            <div class="endpoint-title-group"><span class="method post">POST</span><span class="endpoint-path">/execute</span></div>
                        </div>
                        <div class="form-group">
                            <textarea id="execute-bash" placeholder="mkdir -p src/test&#10;echo 'Hello' > src/test/hello.txt"></textarea>
                        </div>
                        <div class="btn-group">
                            <button class="btn" onclick="testExecute(event)"><span>‚ñ∂Ô∏è</span> Run</button>
                            <button class="btn" onclick="executeFromClipboard(event)"><span>üìã</span> Paste & Run</button>
                        </div>
                        <div class="response" id="execute-response"></div>
                    </div>

                    <div class="endpoint-card">
                        <div class="endpoint-header">
                            <div class="endpoint-title-group">
                                <span class="method get" style="background: var(--ios-blue); color: white;">GET</span>
                                <span class="endpoint-path">/structure</span>
                            </div>
                            <button class="btn-icon-head" onclick="copySelectedStructure(event)" title="Copy Selected">üìã</button>
                        </div>
                        <div class="form-group">
                            <input type="text" id="structure-path" value="." placeholder="Project path">
                        </div>
                        <div class="btn-group">
                            <button class="btn" onclick="testStructure(event)"><span>üå≥</span> View</button>
                        </div>
                        <div class="tree-container" id="structure-tree" style="display: none;">
                            <div class="tree-header"><span>Tree</span><span class="tree-total-tokens" id="total-tokens-badge">0 tokens</span></div>
                            <div class="tree-content" id="tree-content"></div>
                        </div>
                        <div class="response" id="structure-response" style="display: none;"></div>
                    </div>

                    <div class="endpoint-card">
                        <div class="endpoint-header">
                            <div class="endpoint-title-group"><span class="method post">POST</span><span class="endpoint-path">/analyze</span></div>
                            <button class="btn-icon-head" onclick="testAnalyze(event)" title="Download Project Source">üì•</button>
                        </div>
                        <div class="form-group">
                            <input type="text" id="analyze-path" value="." placeholder="Project path (e.g. .)">
                        </div>
                        <div class="btn-group">
                            <button class="btn btn-copy" onclick="copyAnalyzeResult(event)">
                                <span id="analyze-copy-icon">üìã</span>
                                <span id="analyze-copy-text">Copy Text</span>
                            </button>
                        </div>
                        <div class="response" id="analyze-response"></div>
                    </div>
                </div>
                <div style="height: 50px;"></div>
            </div>
        </div>
        <div id="resize-handler" class="resize-handler"></div>

        <div class="right-panel">
            <div id="tabs-header" class="tabs-header">
                <div class="tabs-scroll-area">
                    <div id="file-tabs-container" style="display:flex; height:100%;"></div>
                </div>
                <div class="tabs-actions">
                    <button id="git-view-toggle" class="action-btn-mini" title="Toggle Git View"><span style="font-size:12px">Git</span></button>
                </div>
            </div>
            <div id="git-view-container" class="git-view-container"></div>
            <div class="editor-container" style="flex: 1; position: relative; overflow: hidden;">
                <!-- REPLACED MONACO WITH CODE VIEWER -->
                <div id="code-viewer-container" class="code-viewer-container">
                    <div class="empty-editor">Select a file to view</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals & Overlays -->
    <div id="floating-terminals-layer"></div>
    <div class="toast" id="toast"></div>
    <div id="command-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3 id="modal-title">Add Command</h3>
            <form id="command-form">
                <div class="form-group"><label>Icon (emoji)</label><input type="text" id="command-icon" placeholder="üöÄ" maxlength="2" required></div>
                <div class="form-group"><label>Name</label><input type="text" id="command-name" placeholder="Run Dev Server" required></div>
                <div class="form-group"><label>Command</label><input type="text" id="command-text" placeholder="npm run dev" required></div>
                <div class="modal-actions">
                    <button type="button" class="btn" onclick="closeCommandModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Scripts injected via Gulp -->
</body>
</html>
