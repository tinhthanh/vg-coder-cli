<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>VG Coder - Split View</title>
    <link rel="stylesheet" href="/dashboard.css">
    <link rel="stylesheet" href="/css/structure.css">
    <link rel="stylesheet" href="/css/iframe.css">
    <link rel="stylesheet" href="/css/git-view.css">
    <link rel="stylesheet" href="/css/terminal.css">
    
    <!-- Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" />
    
    <!-- Git Diff -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css" />
    
    <!-- Terminal Dependencies -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css" />
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.min.js"></script>
    
    <!-- Other Libs -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js"></script>

    <script>
        (function () {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
        })();
    </script>
</head>

<body>
    <div class="split-layout">
        <!-- C·ªòT TR√ÅI: Giao di·ªán VG Coder -->
        <div class="left-panel">
            <div class="container">
                <div class="header">
                    <div class="header-content">
                        <span class="status" id="status">‚óè Server Starting...</span>
                        <div style="height: 5px;"></div>
                    </div>
                    <button class="theme-toggle" id="theme-toggle" title="Toggle Dark Mode">
                        <span id="theme-icon">üåô</span>
                    </button>
                </div>
                
                <!-- Quick Actions -->
                <div class="endpoint-card" style="display: flex; gap: 10px; align-items: center; justify-content: space-between;">
                    <span style="font-weight: 600;">Tools:</span>
                    <button class="btn" onclick="createNewTerminal()" style="background: #252526; border: 1px solid #444;">
                        <span>üñ•Ô∏è</span> New Terminal
                    </button>
                </div>

                <!-- System Prompt Section -->
                <div class="system-prompt-card">
                    <div class="system-prompt-header" onclick="toggleSystemPrompt()">
                        <div class="header-title-group">
                            <button class="btn-icon-head" onclick="copySystemPromptFromHeader(event)"
                                title="Copy System Prompt">
                                üìã
                            </button>
                            <h2>System Prompt</h2>
                        </div>
                        <span class="toggle-icon" id="toggle-icon">‚ñº</span>
                    </div>
                    <div class="system-prompt-content" id="system-prompt-content">
                        <div class="prompt-text" id="prompt-text"></div>
                        <button class="btn btn-copy" onclick="copySystemPrompt(event)">
                            <span id="copy-icon">üìã</span>
                            <span id="copy-text">Copy System Prompt</span>
                        </button>
                    </div>
                </div>

                <!-- Extension Installation Guide -->
                <div class="system-prompt-card" id="extension-card">
                    <div class="system-prompt-header" onclick="toggleExtensionGuide()">
                        <div class="header-title-group">
                            <span style="font-size: 16px;">üß©</span>
                            <h2>C√†i ƒë·∫∑t Chrome Extension</h2>
                        </div>
                        <span class="toggle-icon" id="ext-toggle-icon">‚ñº</span>
                    </div>
                    <div class="system-prompt-content" id="extension-content">
                        <div class="extension-steps">
                            <ol>
                                <li style="margin-bottom: 8px;">
                                    Copy link n√†y v√† d√°n v√†o tab m·ªõi:
                                    <div class="form-group" style="margin-top: 5px; margin-bottom: 0;">
                                        <div style="display: flex; gap: 5px;">
                                            <input type="text" id="chrome-url-input" readonly
                                                value="chrome://extensions" onclick="this.select()"
                                                style="font-family: monospace;">
                                            <button class="btn btn-copy" style="flex: 0 0 40px; padding: 0;"
                                                onclick="copyChromeUrl(event)" title="Copy URL">
                                                <span>üìã</span>
                                            </button>
                                        </div>
                                    </div>
                                </li>
                                <li>B·∫≠t <b>Developer mode</b> (G√≥c ph·∫£i tr√™n c√πng)</li>
                                <li>Ch·ªçn <b>Load unpacked</b></li>
                                <li>D√°n ƒë∆∞·ªùng d·∫´n b√™n d∆∞·ªõi v√†o:</li>
                            </ol>
                        </div>
                        <div class="form-group">
                            <input type="text" id="extension-path-input" readonly value="Loading path..."
                                onclick="this.select()">
                        </div>
                        <button class="btn btn-copy" onclick="copyExtensionPath(event)">
                            <span id="ext-copy-icon">üìã</span>
                            <span id="ext-copy-text">Copy Path</span>
                        </button>
                    </div>
                </div>

                <div class="endpoints">
                    <!-- Execute Bash (RESTORED) -->
                    <div class="endpoint-card">
                        <div class="endpoint-header">
                            <div class="endpoint-title-group">
                                <span class="method post">POST</span>
                                <span class="endpoint-path">/execute</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <textarea id="execute-bash"
                                placeholder="mkdir -p src/test&#10;echo 'Hello' > src/test/hello.txt"></textarea>
                        </div>
                        <div class="btn-group">
                            <button class="btn" onclick="testExecute(event)">
                                <span>‚ñ∂Ô∏è</span> Run
                            </button>
                            <button class="btn" onclick="executeFromClipboard(event)">
                                <span>üìã</span> Paste & Run
                            </button>
                        </div>
                        <div class="response" id="execute-response"></div>
                    </div>

                    <!-- Structure -->
                    <div class="endpoint-card">
                        <div class="endpoint-header">
                            <div class="endpoint-title-group">
                                <span class="method get" style="background: var(--ios-blue); color: white;">GET</span>
                                <span class="endpoint-path">/structure</span>
                            </div>
                            <button class="btn-icon-head" onclick="copySelectedStructure(event)" title="Copy Selected">
                                üìã
                            </button>
                        </div>
                        <div class="form-group">
                            <input type="text" id="structure-path" value="." placeholder="Project path">
                        </div>
                        <div class="btn-group">
                            <button class="btn" onclick="testStructure(event)">
                                <span>üå≥</span> View
                            </button>
                        </div>
                        <div class="tree-container" id="structure-tree" style="display: none;">
                            <div class="tree-header">
                                <span>Tree</span>
                                <span class="tree-total-tokens" id="total-tokens-badge">0 tokens</span>
                            </div>
                            <div class="tree-content" id="tree-content"></div>
                        </div>
                        <div class="response" id="structure-response" style="display: none;"></div>
                    </div>

                    <!-- Analyze -->
                    <div class="endpoint-card">
                        <div class="endpoint-header">
                            <div class="endpoint-title-group">
                                <span class="method post">POST</span>
                                <span class="endpoint-path">/analyze</span>
                            </div>
                            <button class="btn-icon-head" onclick="testAnalyze(event)" title="Download Project Source">
                                üì•
                            </button>
                        </div>
                        <div class="form-group">
                            <input type="text" id="analyze-path" value="." placeholder="Project path (e.g. .)">
                        </div>
                        <div class="btn-group">
                            <button class="btn btn-copy" onclick="copyAnalyzeResult(event)">
                                <span id="analyze-copy-icon">üìã</span>
                                <span id="analyze-copy-text">Copy Text</span>
                            </button>
                        </div>
                        <div class="response" id="analyze-response"></div>
                    </div>
                </div>
                <div style="height: 50px;"></div> <!-- Spacer for scrolling -->
            </div>
        </div>

        <!-- C·ªòT PH·∫¢I: AI Iframe with Selector & Git View -->
        <div class="right-panel">
            <div class="ai-header">
                <div class="ai-select-group">
                    <span style="font-size: 16px;">ü§ñ</span>
                    <select id="ai-provider-select" class="ai-select">
                        <!-- Options filled by JS -->
                    </select>
                </div>
                
                <button id="git-view-toggle" class="git-toggle-btn">View Changes</button>
                <button id="git-refresh-btn" class="btn-icon-head" style="display:none; margin-left:5px;" title="Refresh">‚Üª</button>
                
                <a id="ai-external-link" href="#" target="_blank" class="btn-icon-head" title="Open in new tab">‚Üó</a>
            </div>
            
            <!-- Git View Container (Hidden by default) -->
            <div id="git-view-container" class="git-view-container"></div>

            <!-- AI Iframe Container -->
            <div class="ai-iframe-container">
                <div class="iframe-placeholder">
                    <p>‚ö†Ô∏è N·∫øu trang tr·∫Øng, h√£y c√†i Extension <b>"Ignore X-Frame-Options"</b></p>
                    <a id="ai-placeholder-link" href="#" target="_blank" class="link-fallback">M·ªü tab m·ªõi ‚Üó</a>
                </div>
                <iframe id="ai-iframe" src="" title="AI Integration"></iframe>
            </div>
        </div>
    </div>
    
    <!-- Floating Terminals Container (Fixed on top of everything) -->
    <div id="floating-terminals-layer"></div>

    <div class="toast" id="toast"></div>
    <script type="module" src="/js/main.js"></script>
</body>
</html>
